# Bollinger Band Width Aggregation Dashboard - Product Requirements Document

## 1. Executive Summary

### 1.1 Vision Statement
Create a comprehensive real-time dashboard for monitoring Bollinger Band Width patterns across multiple stocks. The dashboard will enable traders to identify and act on volatility squeeze opportunities with enhanced data aggregation and alerting capabilities. Bollinger Band Width is abbreviated as BBW throughout this document.

### 1.2 Business Context
Based on the existing volatility squeeze trading strategy, this dashboard will provide the following capabilities:
- Real-time monitoring of BBW contractions across multiple stocks
- Historical analysis and threshold tracking
- Advanced alerting when stocks approach optimal trading ranges
- Data aggregation to support pattern recognition and decision making

---

## 2. Problem Statement

### 2.1 Current Pain Points
The following pain points have been identified in the current trading workflow:

1. **Manual Monitoring**: Traders must manually check individual stocks for BBW patterns, which is time-consuming and error-prone.
2. **Limited Historical Context**: It is difficult to compare current BBW values against historical minimums without proper tooling.
3. **Delayed Detection**: There are no real-time alerts when stocks enter optimal trading ranges, causing missed opportunities.
4. **Scattered Data**: BBW data exists in the system but is not aggregated for comparative analysis across multiple stocks.
5. **Missing Dashboard**: There is no centralized view of stocks approaching squeeze conditions, making monitoring inefficient.

### 2.2 Business Impact
The identified pain points result in the following business impacts:
- **Missed Opportunities**: Delayed detection of optimal trading conditions leads to missed entry points and reduced profitability.
- **Inefficient Analysis**: Manual monitoring severely limits the number of stocks that can be tracked simultaneously.
- **Poor Risk Management**: Lack of real-time data and historical context affects position sizing and timing decisions.

---

## 3. Product Vision and Goals

### 3.1 Primary Goals
The dashboard aims to achieve the following primary goals:

1. **Real-time Monitoring**: Provide continuous tracking of BBW across selected stocks during market hours.
2. **Historical Analysis**: Enable comparison of current BBW values against historical patterns and minimums.
3. **Intelligent Alerting**: Deliver proactive notifications when optimal trading conditions arise.
4. **Data Aggregation**: Offer a centralized view of BBW patterns and trends across multiple stocks.
5. **Enhanced Decision Making**: Provide context and insights to improve trading decisions and timing.

### 3.2 Success Metrics
The success of the dashboard will be measured using the following key performance indicators:

- **Response Time**: Alert traders within one to two minutes of optimal conditions being detected.
- **Coverage**: Monitor fifty or more stocks simultaneously without performance degradation.
- **Accuracy**: Achieve ninety-five percent or higher accuracy in BBW calculations compared to TradingView.
- **User Adoption**: Enable eighty percent or more of trading decisions to use dashboard insights.
- **Performance**: Ensure dashboard loads and updates within two seconds of data availability.

---

## 4. User Stories and Requirements

### 4.1 Primary User Personas
The dashboard will serve three primary user personas:

- **Active Trader**: Monitors multiple stocks for volatility squeeze opportunities and requires real-time data and alerts.
- **Risk Manager**: Needs an overview of market conditions and exposure across the portfolio.
- **Strategy Analyst**: Analyzes patterns and optimizes trading parameters using historical data and performance metrics.

### 4.2 Core User Stories

#### User Story 001: Real-time BBW Monitoring
**As a trader, I want to see real-time BBW values for all monitored stocks so that I can identify squeeze opportunities as they develop.**

**Acceptance Criteria:**
- Display current BBW values with updates every five minutes during market hours
- Show BBW trend direction using visual indicators for increasing or decreasing values
- Highlight stocks that are approaching their historical minimum BBW values
- Support monitoring of fifty or more stocks simultaneously without performance issues

#### User Story 002: Historical BBW Context
**As a trader, I want to see how current BBW compares to historical minimums so that I can assess the quality of the squeeze opportunity.**

**Acceptance Criteria:**
- Display historical minimum BBW, referred to as lowest minimum BBW width, for each stock
- Show percentage distance from the historical minimum value
- Provide BBW percentile ranking, for example "Current BBW is in fifth percentile"
- Display BBW trend over the last twenty trading periods

#### User Story 003: Threshold-based Alerting
**As a trader, I want to receive alerts when stocks enter optimal trading ranges so that I do not miss opportunities.**

**Acceptance Criteria:**
- Alert when BBW enters plus or minus zero point one percent range of historical minimum
- Detect three to five consecutive contracting candles pattern
- Provide both audio and visual alerts with the stock symbol clearly announced
- Include alert cooldown period to prevent spam, set to three minutes per stock

#### User Story 004: Prioritized Stock List
**As a trader, I want to see stocks ranked by their squeeze potential so that I can focus on the best opportunities.**

**Acceptance Criteria:**
- Rank stocks by proximity to their historical BBW minimum values
- Show a squeeze score based on multiple technical factors
- Show count of candles after stock entered in the BBW range. This will help me find the stocks that are in squeeze range for long time. Higher the number, higher the preference.
- Display the number of consecutive 5-minute candles that have been within the optimal BBW range (within 0.1% of historical minimum) 

### 4.3 Secondary User Stories

#### User Story 006: Dashboard Customization
**As a trader, I want to customize my dashboard view so that I can focus on the most relevant information.**

**Acceptance Criteria:**
- Customizable alert thresholds per individual stock
- A column with opens as OVER-INDICATION, UNDER-INDICATION option which will be stored and update in the table also. Based on the manual checking of stock, i can mark the stock for that particular time 5min candle that either it was over indicating the alert or under indicating. Later I want to see why 
- Personalized dashboard layout and widget arrangement
- Material design

## 5. Functional Requirements

### 5.1 Data Collection and Processing

#### Functional Requirement 001: Real-time Data Ingestion
- Integrate with existing five-minute candle data pipeline infrastructure, once the data is inserted in 5min candle. the dashboard should get updated. 
- Fetch the latest candle data from DB in go and keep in dataframe for faster experience
- Handle data quality validation and automatic error recovery mechanisms

#### Functional Requirement 002: Historical Data Management
- Maintain rolling six-month history of BBW data for all monitored stocks
- Calculate statistical metrics including minimum, maximum, and percentiles
- Support data backfill capabilities for newly added stocks

#### Functional Requirement 003: BBW Calculation Engine
- Use existing TradingView-compatible Bollinger Band calculation methods (this is already implemented. After 5min close, we aggregate the last 5 1min candle to 5min candle, calculate all indicators and store it in stock_candle_data_5min table)

### 5.2 Dashboard Interface

#### Functional Requirement 004: Real-time Dashboard
- Provide live updating stock list with current BBW values
- Display visual indicators for BBW trends and alert status
- Implement responsive design for desktop and tablet use wiht material view
- Include real-time status indicators and connection health monitoring

#### Functional Requirement 005: Stock Detail Views
- Show individual stock BBW charts and historical data
- Display historical minimum and percentile information

#### Functional Requirement 006: Filtering and Search
- Filter stocks by BBW ranges and custom thresholds
- Search functionality by stock symbol name
- Sort by various metrics including BBW, distance from minimum (Few options like 0.1% 1% 5% and 10% should be given or can be dynamic scale), candles in range count, and alert status
- Save and recall custom filter configurations

### 5.3 Alerting System

#### Functional Requirement 007: Multi-channel Alerts
- Audio alerts with customizable sound files
- Visual dashboard notifications with color coding
- Browser notifications when supported by the user's system

#### Functional Requirement 008: Alert Intelligence
- Pattern detection for contracting sequences and trend changes
- Threshold-based alerts with hysteresis to prevent oscillation
- Alert frequency management and configurable cooldown periods
- Alert performance tracking and optimization based on user feedback

### 5.4 Data Management

#### Functional Requirement 009: BBW Data Storage
- Dedicated table for five-minute BBW aggregations with optimized schema (Already there)
- Efficient indexing strategy for time-series queries and lookups
- Data compression techniques for long-term storage optimization
- Comprehensive backup and disaster recovery procedures

#### Functional Requirement 010: Configuration Management
- User preference storage with cloud synchronization capabilities
- Alert threshold configuration on both global and per-stock basis
- Dashboard layout persistence across sessions and devices
- Stock watchlist management with import and export functionality

---

### Non functional requirement
- Use GOTA or GONUM libs in the process to make things fast. 

## 6. Technical Requirements

### 6.1 Database Schema

#### Table: stock candle BBW five minute
The following SQL schema defines the primary table for storing five-minute BBW aggregation data:

```sql
ALTER TABLE stock_candle_bbw_5min add columns
    distance_from_min_percent DECIMAL(5,2) COMMENT 'Percentage distance from historical minimum',
    contracting_sequence_count INT DEFAULT 0 COMMENT 'Consecutive contracting candles',
    candles_in_range_count INT DEFAULT 0 COMMENT 'Consecutive candles within optimal BBW range (0.1% of min)',
    alert_triggered BOOLEAN DEFAULT FALSE,
    alert_triggered_at TIMESTAMP NULL,
    comment TEXT NULL,
    KEY idx_bbw_alert_status (instrument_key, alert_triggered),
    KEY idx_bbw_width_range (bb_width, instrument_key),
    KEY idx_candles_in_range (instrument_key, candles_in_range_count)
```

#### Table: BBW alert history
The following SQL schema defines the table for tracking alert history and user actions:

```sql
CREATE TABLE bbw_alert_history (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    instrument_key VARCHAR(50) NOT NULL,
    alert_type ENUM('threshold', 'pattern', 'squeeze') NOT NULL,
    bb_width DECIMAL(18,8) NOT NULL,
    trigger_condition VARCHAR(500),
    triggered_at TIMESTAMP NOT NULL,
    resolved_at TIMESTAMP NULL,
    user_action VARCHAR(100) COMMENT 'Values: dismissed, acted, snoozed',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    KEY idx_alert_instrument (instrument_key),
    KEY idx_alert_timestamp (triggered_at),
    KEY idx_alert_type (alert_type)
);
```

### 6.2 API Endpoints

#### BBW Data API Endpoints
The following REST API endpoints will provide access to BBW data and functionality:

**GET /api/v1/bbw/stocks**
- Returns list of stocks with current BBW data and status
- Query parameters: limit, offset, filter, sort

**GET /api/v1/bbw/stocks/{symbol}/history**
- Returns historical BBW data for a specific stock symbol
- Query parameters: timeframe, start date, end date

**GET /api/v1/bbw/alerts/active**
- Returns currently active BBW alerts across all monitored stocks
- Query parameters: types, symbols

**POST /api/v1/bbw/alerts/configure**
- Configure alert thresholds and settings for specific stocks
- Request body: alert configuration in JSON format

**GET /api/v1/bbw/statistics**
- Market-wide BBW statistics and distribution data
- Query parameters: timeframe, market segment

#### WebSocket Endpoints
The following WebSocket endpoint will provide real-time updates:

**ws://api/v1/bbw/live**
- Real-time BBW updates during market hours from nine fifteen AM to three thirty PM
- Sends BBW data every five minutes when market is open
- Includes real-time alert notifications and status updates

### 6.3 Performance Requirements

#### Performance Requirement 001: Response Time
- Dashboard initial load time: less than three seconds
- Real-time updates: less than one second from data availability
- API response time: less than five hundred milliseconds for standard queries
- WebSocket latency: less than two hundred milliseconds

#### Performance Requirement 002: Scalability
- Support one hundred or more concurrent dashboard users
- Monitor two hundred or more stocks simultaneously
- Handle ten thousand or more BBW calculations per hour
- Store six months of five-minute BBW data efficiently

#### Performance Requirement 003: Reliability
- Ninety-nine point five percent uptime during market hours
- Graceful degradation when data sources become unavailable
- Automatic retry mechanisms for failed calculations and network issues
- Data consistency validation and automatic correction processes

---

## 7. User Interface Requirements

### 7.1 Dashboard Layout

#### Main Dashboard View
The main dashboard will feature the following layout design for optimal user experience:

```
┌─────────────────────────────────────────────────────────┐
│ BBW Dashboard                          [Settings] [Help] │
├─────────────────────────────────────────────────────────┤
│ Market Status: OPEN     Active Alerts: 3     Time: 2:45PM│
├─────────────────────────────────────────────────────────┤
│ Quick Stats                                             │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐         │
│ │Monitored│ │In Range │ │Alerts   │ │Avg BBW  │         │
│ │   152   │ │    7    │ │   3     │ │ 0.0234  │         │
│ └─────────┘ └─────────┘ └─────────┘ └─────────┘         │
├─────────────────────────────────────────────────────────┤
│ Stock List                                              │
│ [Search...] [Filter ▼] [Sort: BBW ▼] [Export] [+Add]   │
│ ┌───────────────────────────────────────────────────────┤
│ │Symbol │Current BBW│Trend│Min BBW │Distance│In Range│Alert│Time │
│ ├───────┼───────────┼─────┼────────┼────────┼────────┼─────┼─────┤
│ │RELIANCE│  0.0187  │ ↓↓  │0.0172  │ +8.7%  │   3    │ 🔔  │2:40 │
│ │TCS     │  0.0234  │ ↓   │0.0201  │+16.4%  │   0    │     │2:40 │
│ │INFY    │  0.0156  │ ↓↓↓ │0.0143  │ +9.1%  │   7    │ 🔔  │2:40 │
│ └───────┴───────────┴─────┴────────┴────────┴────────┴─────┴─────┤
├─────────────────────────────────────────────────────────┤
│ BBW Distribution Chart              Alert History        │
│ [Interactive Chart Area]            [Recent alerts list] │
└─────────────────────────────────────────────────────────┘
```

#### Stock Detail Modal
The detailed view for individual stocks will display as follows:

```
┌─────────────────────────────────────────────────────────┐
│ RELIANCE - Bollinger Band Width Analysis        [Close] │
├─────────────────────────────────────────────────────────┤
│ Current BBW: 0.0187  │ Trend: Contracting (3 candles)   │
│ Historical Min: 0.0172 │ Percentile: 15th              │
│ Distance: +8.7%       │ Alert Status: Active           │
├─────────────────────────────────────────────────────────┤
│ [BBW Chart with BB bands overlay - last 50 periods]    │
├─────────────────────────────────────────────────────────┤
│ Alert Configuration                                     │
│ ☑ Enable alerts for this stock                         │
│ Threshold: [0.10] % from minimum                       │
│ Pattern: [3] consecutive contracting candles           │
│ Sound: [Default ▼]                                     │
│                               [Save] [Cancel]          │
└─────────────────────────────────────────────────────────┘
```

### 7.2 Visual Elements

#### Color Coding System
The dashboard will use the following color coding for easy visual recognition:

- **Green**: BBW expanding, indicating increased volatility
- **Red**: BBW contracting, indicating decreased volatility
- **Yellow**: BBW near historical minimum, within plus or minus ten percent range
- **Orange**: Alert condition met for the first time
- **Dark Red**: Alert condition already met one candle before, and the current candle is also between the BBW historical range
- **Blue**: Neutral or stable BBW with no significant trend

#### Icons and Indicators
The following visual indicators will be used throughout the interface:

- **Trend Arrows**: Single arrows up or down for mild trends, double arrows for moderate trends, triple arrows for strong trends
- **Alert Bell**: Filled bell icon for active alerts, crossed-out bell icon for snoozed alerts
- **Status Dots**: Green circle for normal status, yellow circle for warning status, red circle for alert status

#### Interactive Elements
The dashboard will include the following interactive features:

- **Hover tooltips** displaying detailed BBW information when users hover over data points
- **Click to drill down** functionality into individual stock analysis views
- **Right-click context menus** providing quick actions for stocks and alerts
- **Keyboard shortcuts** for power users to navigate efficiently

---

## 8. Integration Requirements

### 8.1 Backend Integration

#### Integration Requirement 001: Existing Services
- Extend Stock Group Service for BBW monitoring groups and watchlist management
- Use Candle Processing Service for five-minute data pipeline integration
- Leverage Alert Service for notification delivery and management

#### Integration Requirement 002: Database Integration
- Extend existing MySQL schema with BBW tables and optimized indexing
- Implement data migration scripts for historical BBW calculation and backfill
- Create database indexes for optimal query performance on time-series data
- Add BBW columns to existing stock candle data table for enhanced functionality

#### Integration Requirement 003: Configuration Integration
- Add BBW dashboard configuration to existing application dot yaml file
- Support environment-specific BBW thresholds for development, staging, and production
- Integrate with existing user preference system for personalized settings
- Add BBW monitoring to existing configuration validation and startup checks

### 8.2 Frontend Integration

#### Integration Requirement 004: Existing Components
- Extend current Svelte dashboard framework with BBW-specific components
- Reuse existing Stock Card and Stock Selector components for consistency
- Integrate with existing API Service and WebSocket handling infrastructure
- Leverage existing authentication and session management systems

#### Integration Requirement 005: Navigation Integration
- Add BBW Dashboard to main navigation menu for easy access
- Integrate with existing routing and state management using Svelte stores
- Maintain consistency with existing UI and UX patterns throughout the application
- Support existing responsive design principles for mobile and tablet compatibility

### 8.3 Data Integration

#### Integration Requirement 006: Market Data Sources
- Use existing On 5min close process, as soon as 5min data is inserted in the stock_candle_data_5min table, throw data in socket.
- Leverage existing candle data aggregation logic and processing pipelines
- Maintain data quality validation processes and error handling mechanisms
- Support existing data backup and disaster recovery procedures

---

## 9. Non-Functional Requirements

### 9.1 Performance
The system must meet the following performance requirements:

- **Dashboard Load Time**: Less than three seconds for initial load of the main dashboard
- **Real-time Updates**: Less than one second from market data receipt to dashboard display
- **Concurrent Users**: Support fifty or more simultaneous dashboard users
- **Data Throughput**: Process one thousand or more BBW calculations per minute

### 9.2 Reliability
The system must maintain the following reliability standards:

- **Uptime**: Ninety-nine point five percent availability during market hours from nine fifteen AM to three thirty PM Indian Standard Time
- **Data Accuracy**: Ninety-nine percent or higher accuracy in BBW calculations versus reference sources
- **Error Recovery**: Automatic retry mechanisms and graceful degradation when services are unavailable
- **Data Consistency**: Real-time validation and anomaly detection with automatic correction

### 9.3 Scalability
The system must support the following scalability requirements:

- **Stock Coverage**: Monitor two hundred or more stocks simultaneously without performance degradation
- **Historical Data**: Store six months of five-minute BBW data with efficient compression
- **User Growth**: Support ten times user growth without requiring architectural changes
- **Geographic Distribution**: Support users across multiple time zones with consistent performance

### 9.4 Security
The system must implement the following security measures:

- **Authentication**: Integration with existing user authentication and single sign-on systems
- **Authorization**: Role-based access control to BBW features and administrative functions
- **Data Protection**: Encryption of sensitive trading data both in transit and at rest
- **Audit Trail**: Comprehensive logging of user actions and system events for compliance

### 9.5 Usability
The system must meet the following usability requirements:

- **Learning Curve**: New users should be productive within fifteen minutes of first use
- **Accessibility**: Web Content Accessibility Guidelines version two point one double-A compliance for screen readers
- **Browser Support**: Chrome, Firefox, Safari, and Edge latest two versions
- **Mobile Compatibility**: Responsive design optimized for tablet use and mobile devices

---

## 10. Implementation Phases

### 10.1 Phase 1: Foundation - Weeks 1 through 2
**Goal**: Establish basic BBW calculation and storage infrastructure

**Deliverables**:
- Database schema updation and migration scripts for BBW tables
- Basic API endpoints for BBW data retrieval and management
- Unit tests for core BBW functionality with comprehensive coverage

**Acceptance Criteria**:
- Historical BBW data stored are retrievable through API endpoints
- API endpoints return valid BBW data in expected JSON format
- Ninety percent or higher test coverage for BBW calculations and data processing

### 10.2 Phase 2: Dashboard Core - Weeks 3 through 4
**Goal**: Build basic dashboard interface with real-time updates

**Deliverables**:
- Basic dashboard UI with stock list and real-time data display
- Real-time WebSocket data updates with proper error handling
- BBW trend indicators and visual elements for user feedback
- Basic filtering and sorting functionality for stock management

**Acceptance Criteria**:
- Dashboard displays current BBW for monitored stocks with accurate data
- Real-time updates work correctly during market hours
- Basic filtering and sorting operations function properly
- Visual indicators for BBW trends are implemented and working

### 10.3 Phase 3: Alerting System - Weeks 5 through 6
**Goal**: Implement comprehensive alerting and notification system

**Deliverables**:
- Threshold-based alert detection with configurable parameters
- Pattern detection for contracting sequences and trend analysis
- Audio and visual alert delivery with customizable sounds
- Alert configuration interface for user-specific settings

**Acceptance Criteria**:
- Alerts trigger correctly when BBW enters optimal ranges
- Contracting pattern detection works accurately with configurable sensitivity
- Audio alerts play with proper cooldown periods to prevent spam
- Users can configure alert thresholds per stock with persistent settings

### 10.4 Phase 4: Advanced Features - Weeks 7 through 8
**Goal**: Add advanced analytics and user experience enhancements

**Deliverables**:
- Historical BBW analysis charts with interactive capabilities
- Market-wide BBW statistics and distribution analysis
- Data export functionality supporting multiple formats
- Advanced dashboard customization with user preference persistence

**Acceptance Criteria**:
- Historical charts display BBW trends accurately with proper scaling
- Market statistics provide useful insights for trading decisions
- Data export works for various formats including CSV and Excel
- Dashboard customization saves user preferences across sessions

### 10.5 Phase 5: Optimization and Polish - Weeks 9 through 10
**Goal**: Performance optimization and user experience refinement

**Deliverables**:
- Performance optimization for large datasets and concurrent users
- Enhanced error handling and user feedback mechanisms
- Comprehensive documentation and user guides
- Production deployment with monitoring and alerting systems

**Acceptance Criteria**:
- Dashboard performs well with two hundred or more stocks
- Error conditions are handled gracefully with informative messages
- User documentation is available and comprehensive
- Production monitoring and alerting systems are operational

---

## 11. Success Criteria and Key Performance Indicators

### 11.1 Technical KPIs
The following technical metrics will measure system performance:

- **Data Accuracy**: Greater than ninety-nine percent BBW calculation accuracy versus TradingView
- **Performance**: Less than three seconds dashboard load time under normal conditions
- **Reliability**: Greater than ninety-nine point five percent uptime during market hours
- **Alert Latency**: Less than two minutes from condition detection to alert delivery

### 11.2 Business KPIs
The following business metrics will measure value delivery:

- **User Adoption**: Eighty percent of active traders use BBW dashboard daily
- **Trading Efficiency**: Thirty percent reduction in time to identify trading opportunities
- **Alert Effectiveness**: Seventy percent of alerts result in user action or engagement
- **Strategy Performance**: Measurable improvement in entry timing and trade success rates

### 11.3 User Experience KPIs
The following user experience metrics will measure satisfaction:

- **User Satisfaction**: Greater than four point five out of five rating in user feedback surveys
- **Learning Curve**: Ninety percent of users productive within fifteen minutes of first use
- **Feature Utilization**: Greater than sixty percent of users regularly use advanced features
- **Support Requests**: Less than five percent of users require support for basic functions

---

## 12. Risk Assessment and Mitigation

### 12.1 Technical Risks

#### Risk: BBW Calculation Accuracy
**Impact**: High - Incorrect calculations lead to false signals and trading losses
**Probability**: Medium
**Mitigation Strategies**: 
- Comprehensive testing against TradingView reference implementation
- Dual calculation validation during development phase
- Ongoing accuracy monitoring in production environment

#### Risk: Real-time Data Pipeline Failures
**Impact**: High - Dashboard becomes unusable without live data feeds
**Probability**: Medium
**Mitigation Strategies**:
- Redundant data sources and automatic fallback mechanisms
- Robust error handling and retry logic with exponential backoff
- Real-time monitoring and alerting for data pipeline health

#### Risk: Database Performance Degradation
**Impact**: Medium - Slow queries affect dashboard responsiveness and user experience
**Probability**: Medium
**Mitigation Strategies**:
- Proper indexing strategy specifically designed for time-series data
- Data archival and cleanup procedures with automated scheduling
- Performance monitoring and optimization with query analysis tools

### 12.2 Business Risks

#### Risk: User Adoption Challenges
**Impact**: High - Low adoption reduces business value and return on investment
**Probability**: Low
**Mitigation Strategies**:
- User-centered design approach with regular stakeholder feedback
- Comprehensive user testing and feedback collection during development
- Gradual rollout with training sessions and comprehensive support

#### Risk: Alert Fatigue
**Impact**: Medium - Too many alerts reduce effectiveness and user engagement
**Probability**: Medium
**Mitigation Strategies**:
- Intelligent alert throttling and configurable cooldown periods
- Configurable alert thresholds per user with machine learning optimization
- Alert effectiveness tracking and continuous optimization based on user behavior

### 12.3 Operational Risks

#### Risk: Increased System Load
**Impact**: Medium - Additional processing affects overall system performance
**Probability**: Low
**Mitigation Strategies**:
- Gradual rollout to monitor system impact with performance metrics
- Resource monitoring and automatic scaling capabilities
- Optimization of BBW calculation algorithms for efficiency

---

## 13. Dependencies and Assumptions

### 13.1 Technical Dependencies
The following technical dependencies must be maintained for successful implementation:

- **Market Data Feed**: Reliable five-minute OHLCV data from Upstox and Dhan APIs
- **Existing Infrastructure**: Current candle processing pipeline and technical indicator services
- **Database Performance**: MySQL performance optimized for time-series data storage and retrieval
- **WebSocket Infrastructure**: Real-time data delivery capabilities for dashboard updates

### 13.2 Business Dependencies
The following business dependencies are critical for project success:

- **User Feedback**: Active trader participation in testing and feedback collection
- **Strategy Validation**: Confirmation that BBW alerts improve trading outcomes and profitability
- **Resource Allocation**: Dedicated development and testing resources throughout project timeline
- **Market Conditions**: Sufficient market volatility to validate BBW patterns and alert effectiveness

### 13.3 Key Assumptions
The following assumptions underpin the project planning and design:

- **User Behavior**: Traders will actively monitor dashboard during market hours from nine fifteen AM to three thirty PM
- **Data Quality**: Market data feed maintains current reliability levels and accuracy standards
- **Technology Stack**: Current technology choices including Go backend and Svelte frontend remain viable
- **Performance**: Current infrastructure can handle additional BBW processing load without significant degradation

---

## 14. Appendices

### 14.1 Glossary

The following terms are used throughout this document:
**Bollinger Band Width or BBW**: Normalized measure of volatility calculated as Upper Bollinger Band minus Lower Bollinger Band divided by Middle Bollinger Band

**Contracting Pattern**: Sequence of three to five consecutive candles with decreasing BBW values indicating potential squeeze conditions

**Historical Minimum BBW**: Lowest BBW value observed for a stock over a specified lookback period, typically six months

**Optimal Trading Range**: BBW within plus or minus zero point one percent of historical minimum, indicating potential squeeze conditions

**Candles in Range Count**: Number of consecutive 5-minute candles that have remained within the optimal BBW range (within 0.1% of historical minimum), indicating how long a stock has been in squeeze conditions

**Squeeze Opportunity**: Condition where BBW is near historical minimums, suggesting potential breakout or significant price movement

**Five-minute Candles**: Open, High, Low, Close, and Volume data aggregated over five-minute intervals during trading hours

**TradingView Compatibility**: Calculations that match TradingView platform results for consistency and validation

### 14.2 Reference Documents
The following documents provide additional context and technical details:

- Volatility Squeeze Strategy Documentation in file five point one volatility squeeze strategy dot txt
- BB Width Live Monitoring Requirements in file six point one live BB width monitoring alerts dot md
- Technical Indicator Service Implementation in internal slash service slash technical indicator service dot go
- Existing Dashboard Architecture in frontend slash src slash routes slash plus page dot svelte

### 14.3 Stakeholder Contact Information
The following stakeholders are responsible for various aspects of the project:

- **Product Owner**: Trading Strategy Team responsible for business requirements and acceptance criteria
- **Technical Lead**: Backend Development Team responsible for Go services and database implementation
- **UI and UX Designer**: Frontend Development Team responsible for Svelte components and user experience
- **QA Lead**: Quality Assurance Team responsible for testing and validation
- **DevOps Lead**: Infrastructure Team responsible for deployment and monitoring

---

## 15. Implementation Gaps and Root Cause Analysis

### 15.1 Critical Implementation Gaps Identified

#### Gap 1: Historical Minimum BBW Calculation Inaccuracy
**Issue**: The current implementation calculates historical minimum BBW from recent data only (last 6 candles) instead of using actual historical data from the database or CSV files.

**Impact**: 
- Incorrect squeeze detection and alert triggers
- Misleading distance calculations from historical minimum
- Poor trading decision support due to inaccurate data

**Root Cause Analysis**:
- **Primary Cause**: `calculateHistoricalMinBBW()` method uses only recent `bbwValues` array instead of historical data
- **Secondary Cause**: No integration with existing `utilityService.getLowestMinBBWidth()` method that reads from CSV
- **Contributing Factor**: Lack of proper data source validation and testing

**Evidence**:
```go
// Current flawed implementation
func (s *BBWDashboardService) calculateHistoricalMinBBW(bbwValues []float64) float64 {
    minBBW := bbwValues[0]
    for _, bbw := range bbwValues {
        if bbw < minBBW {
            minBBW = bbw
        }
    }
    return minBBW
}
```

#### Gap 2: Candles in Range Count Not Persisted
**Issue**: The `candles_in_range_count` is calculated on-the-fly but never stored in the database, making it inefficient for historical analysis and real-time updates.

**Impact**:
- Performance degradation with large datasets
- No historical tracking of squeeze duration patterns
- Inconsistent with PRD requirement for database storage

**Root Cause Analysis**:
- **Primary Cause**: Missing database update logic after calculation
- **Secondary Cause**: No consideration for performance implications of repeated calculations
- **Contributing Factor**: Incomplete implementation of database schema utilization

**Evidence**:
```go
// Calculated but not stored
candlesInRangeCount := s.calculateCandlesInRangeCount(ctx, stock.InstrumentKey, historicalMinBBW)
// Missing: Database update for candles_in_range_count
```

#### Gap 3: Data Source Inconsistency for Candle Retrieval
**Issue**: The `calculateCandlesInRangeCount` method uses `candleAggService.Get5MinCandles()` which returns `AggregatedCandle` but converts to `Candle5Min`, creating potential data mismatches.

**Impact**:
- Potential loss of BBW data during conversion
- Inconsistent data structure usage
- Risk of calculation errors due to incomplete data

**Root Cause Analysis**:
- **Primary Cause**: Wrong data source selection for candle retrieval
- **Secondary Cause**: Incomplete understanding of data flow between services
- **Contributing Factor**: Lack of proper data validation and type safety

**Evidence**:
```go
// Wrong data source
candles, err := s.candleAggService.Get5MinCandles(ctx, instrumentKey, startTime, endTime)
// Should use: s.candle5MinRepo.FindByInstrumentAndTimeRange()
```

#### Gap 4: Missing Error Handling for Historical Data
**Issue**: No proper error handling when historical minimum BBW data is unavailable or corrupted.

**Impact**:
- System crashes or incorrect calculations when data is missing
- Poor user experience during data outages
- Potential trading decisions based on invalid data

**Root Cause Analysis**:
- **Primary Cause**: Insufficient error handling in data retrieval methods
- **Secondary Cause**: No fallback mechanisms for missing historical data
- **Contributing Factor**: Incomplete testing of edge cases

### 15.2 Performance and Scalability Gaps

#### Gap 5: Inefficient Database Queries
**Issue**: Multiple database queries per stock per 5-minute cycle without proper optimization.

**Impact**:
- High database load during market hours
- Potential performance bottlenecks with 200+ stocks
- Increased infrastructure costs

**Root Cause Analysis**:
- **Primary Cause**: No query optimization or caching strategy
- **Secondary Cause**: Lack of batch processing for multiple stocks
- **Contributing Factor**: Insufficient performance testing

#### Gap 6: Memory Management Issues
**Issue**: In-memory cache without size limits could lead to memory exhaustion.

**Impact**:
- Potential system crashes under high load
- Poor performance with large datasets
- Resource wastage

**Root Cause Analysis**:
- **Primary Cause**: No memory management strategy for cache
- **Secondary Cause**: Lack of cache eviction policies
- **Contributing Factor**: Insufficient load testing

### 15.3 Testing and Quality Assurance Gaps

#### Gap 7: Incomplete Test Coverage
**Issue**: Missing unit tests for critical calculation methods and integration tests for data flow.

**Impact**:
- Risk of undetected bugs in production
- Difficult to validate fixes and improvements
- Poor code maintainability

**Root Cause Analysis**:
- **Primary Cause**: Insufficient test coverage requirements
- **Secondary Cause**: Lack of automated testing pipeline
- **Contributing Factor**: Time pressure during development

#### Gap 8: Missing Performance Benchmarks
**Issue**: No performance benchmarks or load testing for the BBW dashboard system.

**Impact**:
- Unknown system limits and bottlenecks
- Risk of performance issues in production
- Difficult capacity planning

**Root Cause Analysis**:
- **Primary Cause**: No performance testing strategy
- **Secondary Cause**: Lack of performance requirements definition
- **Contributing Factor**: Insufficient infrastructure planning

---

## 16. Implementation Plan and Corrective Actions

### 16.1 Phase 1: Critical Fixes (Week 1)

#### 16.1.1 Fix Historical Minimum BBW Calculation
**Priority**: Critical
**Effort**: 2 days
**Dependencies**: None

**Tasks**:
1. **Update `calculateHistoricalMinBBW` method**:
   ```go
   func (s *BBWDashboardService) getHistoricalMinBBW(ctx context.Context, instrumentKey string) (float64, error) {
       // Use existing utilityService method
       return s.utilityService.getLowestMinBBWidth(instrumentKey)
   }
   ```

2. **Update `processStockBBW` method** to use new historical minimum:
   ```go
   // Replace calculateHistoricalMinBBW(bbwValues) with:
   historicalMinBBW, err := s.getHistoricalMinBBW(ctx, stock.InstrumentKey)
   if err != nil {
       log.BBWError("historical_min", "get_failed", "Failed to get historical minimum", err, map[string]interface{}{
           "instrument_key": stock.InstrumentKey,
       })
       return nil, err
   }
   ```

3. **Add fallback mechanism** for missing historical data:
   ```go
   if historicalMinBBW <= 0 {
       // Use recent minimum as fallback
       historicalMinBBW = s.calculateRecentMinBBW(bbwValues)
       log.BBWWarn("historical_min", "fallback", "Using recent minimum as fallback", map[string]interface{}{
           "instrument_key": stock.InstrumentKey,
           "fallback_value": historicalMinBBW,
       })
   }
   ```

**Acceptance Criteria**:
- Historical minimum BBW is retrieved from CSV/database
- Proper error handling for missing data
- Fallback mechanism implemented
- Unit tests pass for all scenarios

#### 16.1.2 Fix Data Source for Candle Retrieval
**Priority**: Critical
**Effort**: 1 day
**Dependencies**: None

**Tasks**:
1. **Update `getRecentCandles` method**:
   ```go
   func (s *BBWDashboardService) getRecentCandles(ctx context.Context, instrumentKey string, count int) ([]domain.Candle5Min, error) {
       endTime := time.Now()
       startTime := endTime.Add(-time.Duration(count*5) * time.Minute)
       
       // Use direct repository instead of aggregation service
       return s.candle5MinRepo.FindByInstrumentAndTimeRange(ctx, instrumentKey, "5minute", startTime, endTime)
   }
   ```

2. **Add data validation**:
   ```go
   // Validate BBW data before processing
   for _, candle := range candles {
       if candle.BBWidth <= 0 {
           log.BBWWarn("candle_validation", "invalid_bbw", "Invalid BBW value", map[string]interface{}{
               "instrument_key": instrumentKey,
               "timestamp": candle.Timestamp,
               "bb_width": candle.BBWidth,
           })
       }
   }
   ```

**Acceptance Criteria**:
- Direct database queries for candle data
- Proper data validation implemented
- No data conversion issues
- Performance improvement measured

#### 16.1.3 Implement Database Persistence for Candles in Range Count
**Priority**: High
**Effort**: 2 days
**Dependencies**: Database schema (already implemented)

**Tasks**:
1. **Add database update method**:
   ```go
   func (s *BBWDashboardService) updateCandlesInRangeCount(ctx context.Context, instrumentKey string, count int) error {
       // Update the latest candle record with candles_in_range_count
       return s.candle5MinRepo.UpdateCandlesInRangeCount(ctx, instrumentKey, count)
   }
   ```

2. **Update `processStockBBW` method** to persist data:
   ```go
   // After calculating candlesInRangeCount
   if err := s.updateCandlesInRangeCount(ctx, stock.InstrumentKey, candlesInRangeCount); err != nil {
       log.BBWError("persistence", "update_failed", "Failed to update candles in range count", err, map[string]interface{}{
           "instrument_key": stock.InstrumentKey,
           "count": candlesInRangeCount,
       })
   }
   ```

3. **Add repository method**:
   ```go
   // In candle_5min_repository.go
   func (r *Candle5MinRepository) UpdateCandlesInRangeCount(ctx context.Context, instrumentKey string, count int) error {
       return r.db.Model(&domain.Candle5Min{}).
           Where("instrument_key = ? AND timestamp = (SELECT MAX(timestamp) FROM stock_candle_data_5min WHERE instrument_key = ?)", 
               instrumentKey, instrumentKey).
           Update("candles_in_range_count", count).Error
   }
   ```

**Acceptance Criteria**:
- Candles in range count persisted to database
- No performance degradation
- Data consistency maintained
- Error handling implemented

### 16.2 Phase 2: Performance Optimization (Week 2)

#### 16.2.1 Implement Caching Strategy
**Priority**: High
**Effort**: 3 days
**Dependencies**: Phase 1 completion

**Tasks**:
1. **Add historical minimum cache**:
   ```go
   type BBWDashboardService struct {
       // ... existing fields
       historicalMinCache map[string]float64
       cacheMutex         sync.RWMutex
       cacheTTL           time.Duration
   }
   ```

2. **Implement cache methods**:
   ```go
   func (s *BBWDashboardService) getCachedHistoricalMin(instrumentKey string) (float64, bool) {
       s.cacheMutex.RLock()
       defer s.cacheMutex.RUnlock()
       value, exists := s.historicalMinCache[instrumentKey]
       return value, exists
   }
   
   func (s *BBWDashboardService) setCachedHistoricalMin(instrumentKey string, value float64) {
       s.cacheMutex.Lock()
       defer s.cacheMutex.Unlock()
       s.historicalMinCache[instrumentKey] = value
   }
   ```

3. **Add cache eviction policy**:
   ```go
   func (s *BBWDashboardService) startCacheCleanup() {
       ticker := time.NewTicker(s.cacheTTL)
       go func() {
           for range ticker.C {
               s.cleanupCache()
           }
       }()
   }
   ```

**Acceptance Criteria**:
- Historical minimum values cached
- Cache eviction working
- Performance improvement measured
- Memory usage controlled

#### 16.2.2 Optimize Database Queries
**Priority**: Medium
**Effort**: 2 days
**Dependencies**: Phase 1 completion

**Tasks**:
1. **Add batch processing** for multiple stocks:
   ```go
   func (s *BBWDashboardService) processStocksBatch(ctx context.Context, stocks []domain.StockUniverse) error {
       // Process stocks in batches of 10
       batchSize := 10
       for i := 0; i < len(stocks); i += batchSize {
           end := i + batchSize
           if end > len(stocks) {
               end = len(stocks)
           }
           batch := stocks[i:end]
           if err := s.processStockBatch(ctx, batch); err != nil {
               return err
           }
       }
       return nil
   }
   ```

2. **Add query optimization**:
   ```go
   // Use proper indexes and limit queries
   func (r *Candle5MinRepository) GetLatestCandlesOptimized(ctx context.Context, instrumentKey string, limit int) ([]domain.Candle5Min, error) {
       var candles []domain.Candle5Min
       err := r.db.Where("instrument_key = ?", instrumentKey).
           Order("timestamp DESC").
           Limit(limit).
           Find(&candles).Error
       return candles, err
   }
   ```

**Acceptance Criteria**:
- Batch processing implemented
- Query performance improved
- Database load reduced
- Scalability tested

### 16.3 Phase 3: Testing and Quality Assurance (Week 3)

#### 16.3.1 Comprehensive Unit Testing
**Priority**: High
**Effort**: 3 days
**Dependencies**: Phase 1 completion

**Tasks**:
1. **Test historical minimum calculation**:
   ```go
   func TestGetHistoricalMinBBW(t *testing.T) {
       // Test with valid CSV data
       // Test with missing CSV data
       // Test with corrupted CSV data
       // Test fallback mechanism
   }
   ```

2. **Test candles in range calculation**:
   ```go
   func TestCalculateCandlesInRangeCount(t *testing.T) {
       // Test with various BBW patterns
       // Test edge cases
       // Test performance with large datasets
   }
   ```

3. **Test alert conditions**:
   ```go
   func TestCheckAdvancedAlertConditions(t *testing.T) {
       // Test threshold alerts
       // Test pattern alerts
       // Test squeeze alerts
       // Test alert cooldown
   }
   ```

**Acceptance Criteria**:
- 90%+ test coverage for critical methods
- All edge cases covered
- Performance tests included
- Integration tests working

#### 16.3.2 Load Testing and Performance Validation
**Priority**: Medium
**Effort**: 2 days
**Dependencies**: Phase 2 completion

**Tasks**:
1. **Create load testing scenarios**:
   - 50 stocks processing
   - 200 stocks processing
   - Concurrent WebSocket connections
   - Database load testing

2. **Implement performance monitoring**:
   ```go
   func (s *BBWDashboardService) recordMetrics(operation string, duration time.Duration) {
       // Record metrics for monitoring
       metrics.RecordDuration("bbw_dashboard_operation", operation, duration)
   }
   ```

3. **Add performance benchmarks**:
   ```go
   func BenchmarkProcessStockBBW(b *testing.B) {
       // Benchmark stock processing
   }
   
   func BenchmarkCalculateCandlesInRange(b *testing.B) {
       // Benchmark candles in range calculation
   }
   ```

**Acceptance Criteria**:
- Load testing scenarios defined
- Performance benchmarks established
- Monitoring metrics implemented
- Performance targets met

### 16.4 Phase 4: Production Readiness (Week 4)

#### 16.4.1 Error Handling and Resilience
**Priority**: High
**Effort**: 2 days
**Dependencies**: Phase 3 completion

**Tasks**:
1. **Implement circuit breakers**:
   ```go
   type CircuitBreaker struct {
       failures    int
       lastFailure time.Time
       threshold   int
       timeout     time.Duration
       state       string // "closed", "open", "half-open"
   }
   ```

2. **Add graceful degradation**:
   ```go
   func (s *BBWDashboardService) processStockWithFallback(ctx context.Context, stock domain.StockUniverse) (*BBWDashboardData, error) {
       // Try primary method, fallback to cached data if failed
   }
   ```

3. **Implement retry mechanisms**:
   ```go
   func (s *BBWDashboardService) retryOperation(operation func() error, maxRetries int) error {
       // Implement exponential backoff retry
   }
   ```

**Acceptance Criteria**:
- Circuit breakers implemented
- Graceful degradation working
- Retry mechanisms functional
- Error recovery tested

#### 16.4.2 Monitoring and Alerting
**Priority**: Medium
**Effort**: 2 days
**Dependencies**: Phase 3 completion

**Tasks**:
1. **Add health checks**:
   ```go
   func (s *BBWDashboardService) HealthCheck() map[string]interface{} {
       return map[string]interface{}{
           "status": "healthy",
           "cache_size": len(s.historicalMinCache),
           "monitored_stocks": len(s.monitoredStocks),
           "last_update": s.lastUpdate,
       }
   }
   ```

2. **Implement monitoring dashboards**:
   - BBW calculation performance
   - Database query performance
   - WebSocket connection metrics
   - Error rates and recovery

3. **Add alerting rules**:
   - High error rates
   - Performance degradation
   - Data quality issues
   - System resource usage

**Acceptance Criteria**:
- Health checks implemented
- Monitoring dashboards created
- Alerting rules configured
- Production monitoring active

### 16.5 Success Metrics and Validation

#### 16.5.1 Technical Metrics
- **Data Accuracy**: 99%+ accuracy in historical minimum BBW calculation
- **Performance**: < 2 seconds for dashboard data retrieval
- **Reliability**: 99.5%+ uptime during market hours
- **Scalability**: Support 200+ stocks without performance degradation

#### 16.5.2 Business Metrics
- **User Adoption**: 80%+ of traders use dashboard daily
- **Alert Effectiveness**: 70%+ of alerts result in user action
- **Trading Efficiency**: 30% reduction in time to identify opportunities
- **Strategy Performance**: Measurable improvement in entry timing

#### 16.5.3 Quality Metrics
- **Test Coverage**: 90%+ for critical components
- **Code Quality**: Zero critical security vulnerabilities
- **Documentation**: 100% API documentation coverage
- **Performance**: All benchmarks meet targets

---

*This Product Requirements Document serves as the foundation for implementing the Bollinger Band Width Aggregation Dashboard. It should be reviewed and approved by all stakeholders before development begins. All technical specifications and business requirements detailed in this document have been optimized for accessibility and speech synthesis compatibility.*
